<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet"> <!-- 引入 Font Awesome -->
     <!-- Add Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <style>
        body {
            background-color: #272727;
            color: #FFFFFF; /* 預設文字顏色是白色 */
            font-family: "微軟正黑體", Source Code Pro, sans-serif; /* 中,英預設字體 */
            height: auto; /* 設定高度讓body可以根據內容做高度調整*/
              
        }
         ::-webkit-scrollbar {
           display: none; /* 隱藏webkit瀏覽器的滾動條*/
        }
        h1 {
            font-size: 30px;
            margin: 5mm;
            background-color: #3C3C3C;
            border-radius: 10px;
        }
        h2 {
            font-size: 25px;
            margin: 0mm;
            background-color: transparent;
        }
        p {
            font-size: 20px;
            background-color: transparent;
        }
        img {
            border-radius: 5px; /* 將四個角的圓角半徑設為 5px */
        }

        .button-container {
            margin-top: 10px; /* 設定按鈕容器的頂部外邊距為 20px */
        }
        .social-button {
            display: inline-block; /* 將按鈕設定為行內區塊元素，方便排列 */
            margin: 10px; /* 設定按鈕之間的左右外邊距為 10px */
            padding: 10px 20px; /* 設定按鈕的內部填充為上下 10px，左右 20px */
            font-size: 20px; /* 設定按鈕文字的大小為 20px */
            color: #FFFFFF; /* 設定按鈕文字的顏色為白色 */
            background-color: #5B5B5B; /* 設定按鈕的背景顏色為灰色 */
            border: none; /* 取消按鈕的邊框 */
            border-radius: 10px; /* 設定按鈕的圓角為 10px */
            text-decoration: none; /* 移除按鈕的連結下劃線樣式 */
            cursor: pointer; /* 滑鼠移到按鈕上時游標變為手型 */
            transition: background-color 0.6s; /* 設定按鈕的背景顏色在滑鼠移入移出時有過渡效果 */
        }
        .social-button i {
            margin-right: 10px; /* 設定圖標和文字之間的間距 */
        }
        .social-button:hover {
            background-color: #d0d0d0; /* 滑鼠移入按鈕時的背景顏色 */
            color: #4F4F4F;
        }
         /* 按鈕追蹤樣式 */
        .track-button{
            background-color: #4CAF50; /* Green */
              border: none;
              color: white;
              padding: 5px 2px;
              text-align: center;
             text-decoration: none;
                display: inline-block;
             font-size: 6px;
            cursor: pointer;
             border-radius: 4px;
           margin-top: 20px; /* 加個 margin-top */
           }
         .popup{
               display:none;/* initially hide popup */
                position:fixed;/* pop up layer */
                 top: 50%;
                  left: 50%;
                transform: translate(-50%, -50%); /* 調整 pop up 位置 */
               background-color: white; /* background colour of popup */
               padding: 20px;
                border-radius: 8px; /* popup layer border */
                 z-index:100; /*ensure pop up will always over layer content*/
              max-width: 600px;
               max-height: 800px;
                 overflow: auto; /*讓 pop up 可滾動 */
                color: #333;

           }
        .popup.active{
                 display:block;
          }

    </style>
    <title>吳秉乾的小小網站</title>
</head>

<body>
    <center>
        <h1>～自我介紹～</h1>
    </center>
      
    <h2>個人小檔案</h2>    
    <img src="https://github.com/Benson-WU980419/-/blob/main/S__11296777.jpg?raw=true" alt="photo_error" align="right" height="204.8" width="136.5">
    <p>姓名：吳秉勳<br>
       綽號：吳秉乾<br>
       英文：Benson Wu<br>
       生日：2009/04/19<br>
       興趣：拍照、拆解東西<br>
       學校：國立臺中科技大學<br>
       科系：資訊工程科(五專)
    </p>
    <h2>社交軟體帳號</h2>
    <div class="button-container">
        <a href="https://www.facebook.com/wu.benson0419" class="social-button" target="_blank">
            <i class="fa-brands fa-facebook"></i>Facebook
        </a><br>
        <a href="https://www.instagram.com/wu.benson0419" class="social-button" target="_blank">
            <i class="fa-brands fa-instagram"></i>Instagram
        </a><br>
        <a href="https://www.threads.net/@wu.benson0419" class="social-button" target="_blank">
            <i class="fa-brands fa-threads"></i>Threads
        </a><br>
        <a href="https://line.me/ti/p/gwNsHrbZ9Y" class="social-button" target="_blank">
            <i class="fa-brands fa-line"></i>Line
        </a>
    </div>
    <center>
        <button class="track-button" id="trackButton">點我追蹤次數</button>  <!-- 新增追蹤按鈕 -->
    </center>
    <div id="clickDataPopup" class="popup">    <!-- 顯示點擊次數彈跳視窗 -->
      <h2 id="totalClickTitle">按鈕點擊數據</h2>
          <p>總點擊次數: <span id="totalClickCount">0</span> 次</p>  <!--  總共點擊次數顯示 -->
             <h3>點擊紀錄</h3>
         <div id="clickHistory"></div>  <!-- 歷史資料列表 -->
     </div>

     <script>

        const supabaseUrl = 'https://wgimufedjipchreseonf.supabase.co';  // 輸入 supabase url
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndnaW11ZmVkamlwY2hyZXNlb25mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzYyMjUzNDIsImV4cCI6MjA1MTgwMTM0Mn0.pkRbrpSfMulIH_prx2rVRTZuezKKM8Q9q97ZfKBRLCo'; // 輸入 anon key
        // supabase client
       const supabase = supabase.createClient(supabaseUrl, supabaseKey)

         // 獲取所有需要的 DOM 元素
         const trackButton = document.getElementById('trackButton');
          const clickDataPopup = document.getElementById('clickDataPopup');
          const totalClickCountElement = document.getElementById('totalClickCount')
          const clickHistoryElement =  document.getElementById('clickHistory')
       //彈跳視窗顯示和隱藏
         function togglePopup(){
               clickDataPopup.classList.toggle("active")
          }

        // 按下按鈕時執行的函數
          async function trackButtonClick(){
                 // 打開資料
                togglePopup()
                // 將點擊數據發送到 supbase
             const  {error}  = await supabase
                 .from("button_clicks") // 輸入 table name
                  .insert([
                  {
                    timestamp: new Date().toISOString() ,  //獲取時間戳記
                    count:1   // 設定計數為1
                }
            ])
                 if (error){
                   console.error("error", error)
                 }
              //更新顯示點擊次數
            updateClickData()

       }
       async function updateClickData()
      {
             let  { data: button_clicks, error } = await supabase  // table 名稱
                     .from("button_clicks") // 輸入 table name
                       .select()
             if (error)
              {
                  console.error("error fetch history", error)

           }else
            {
               totalClickCountElement.innerText = button_clicks.length
                let list = button_clicks.map((entry) =>{

                      const date = new Date(entry.timestamp); // 時間戳轉化為日期

                         return `<p> ${date.toLocaleString()}</p>`
                     }
                      )

                   clickHistoryElement.innerHTML = list.join("")
                }
      }
    updateClickData(); // 初次讀取的時候跑一次
    trackButton.addEventListener("click", trackButtonClick);  //監聽按鈕點擊事件

      //彈跳視窗點擊任何地方關閉視窗
    clickDataPopup.addEventListener('click', (event) =>
      {
       // 點擊 popup 時檢查是不是點擊在整個 container
      if (event.target === clickDataPopup){
             togglePopup()
         }
        });
 </script>
</body>
</html>
